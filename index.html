<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Farkle</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">
</head>
<body>
    <div class="container-fluid vh-100 d-flex flex-column">
        <div class="row flex-grow-1">
            <!-- Controls on the left -->
            <div class="col-md-3 d-flex flex-column gap-3 bg-dark text-white p-3"> 
                <h2 class="text-center">Farkle</h2>
                <div id="room-player-info" class="text-center small" style="display: none;">
                    <div class="text-light bg-secondary rounded px-2 py-1">
                        <span id="current-room-name"></span> | <span id="current-player-name"></span>
                    </div>
                </div>
                <div id="admin-section">
                    <div class="row g-2">
                        <div class="col-3">
                            <button id="admin-button" class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#adminModal">Admin</button>
                        </div>
                        <div class="col-3">
                            <button id="customize-game-button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#gameSettingsModal" style="display: none;">Game Rules</button>
                        </div>
                        <div class="col-3">
                            <button id="materials-button" class="btn btn-info w-100" data-bs-toggle="modal" data-bs-target="#materialsModal">Materials</button>
                        </div>
                        <div class="col-3">
                            <button id="scoring-button" class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#scoringModal">Scoring</button>
                        </div>
                    </div>
                </div>
                <div id="room-setup">
                    <input type="text" id="room-name" class="form-control" placeholder="Enter room name">
                </div>
                <div id="player-setup">
                    <input type="text" id="player-name" class="form-control mb-2" placeholder="Enter your name">
                    <div id="name-error" class="text-danger small mb-2" style="display: none;"></div>
                    <button id="join-room" class="btn btn-success w-100">Join Room</button>
                </div>
                <div id="camera-controls" style="display: none;">
                    <label for="camera-height" class="form-label">Camera Height:</label>
                    <input type="range" id="camera-height" class="form-range" min="5" max="20" value="10">

                    <label for="camera-distance" class="form-label">Camera Distance:</label>
                    <input type="range" id="camera-distance" class="form-range" min="5" max="20" value="10">

                    <label for="camera-angle" class="form-label">Camera Angle:</label>
                    <input type="range" id="camera-angle" class="form-range" min="-45" max="45" value="0">
                </div>
                <div id="player-list" class="mt-3">
                    <h5 id="player-list-title" style="display: none;">Player List</h5>
                    <ul class="list-group">
                    </ul>
                </div>
            </div>

            <div class="col-md-9 d-flex flex-column align-items-center justify-content-center">
                <div class="card bg-dark border-2 border-primary shadow-sm mb-4" style="min-width: 300px;">
                    <div class="card-body text-center">
                        <div class="d-flex flex-column align-items-center gap-3">
                            <div id="controls">
                                <button id="roll-dice" class="btn btn-primary btn-lg px-4">Roll Dice</button>
                            </div>
                            <div id="energy-slider-container" class="d-flex align-items-center gap-3 w-100 justify-content-center">
                                <label for="energy-slider" class="form-label mb-0 text-nowrap fw-bold text-light">Roll Energy:</label>
                                <input type="range" id="energy-slider" class="form-range" min="10" max="30" value="12" style="width: 150px;">
                            </div>
                        </div>
                    </div>
                </div>
                <div id="dice-results-container" class="mb-3 d-flex justify-content-center align-items-center flex-wrap gap-2" style="min-height: 80px;">
                    <!-- Dice result images will be displayed here -->
                </div>
                <div id="dice-selection-controls" class="mb-3" style="display: none;">
                    <button id="lock-selected-dice" class="btn btn-success me-2">Lock Selected Dice</button>
                    <button id="clear-selection" class="btn btn-secondary me-2">Clear Selection</button>
                    <button id="bank-points" class="btn btn-warning me-2" style="display: none;">Bank Points & End Turn</button>
                    <div class="mt-2">
                        <small class="text-muted">Click on dice above to select them for locking</small>
                    </div>
                </div>
                <canvas id="dice-canvas" class="w-100" style="max-width: 800px; height: 500px;"></canvas>
            </div>
        </div>
    </div>

    <!-- Admin Modal -->
    <div class="modal fade" id="adminModal" tabindex="-1" aria-labelledby="adminModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="adminModalLabel">Admin Panel</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Room Management</h6>
                    <div class="mb-3">
                        <button id="clear-room" class="btn btn-danger">Clear Current Room</button>
                        <div id="clear-room-status" class="mt-2 small" style="display: none;"></div>
                    </div>
                    <div class="mb-3">
                        <button id="reset-scores" class="btn btn-warning">Reset All Scores</button>
                        <div id="reset-scores-status" class="mt-2 small" style="display: none;"></div>
                    </div>
                    <h6>Database Management</h6>
                    <div class="mb-3">
                        <button id="clear-database" class="btn btn-danger">Clear All Rooms</button>
                        <div id="clear-database-status" class="mt-2 small" style="display: none;"></div>
                    </div>
                    <div class="mb-3 d-flex align-items-center">
                        <button id="test-firebase" class="btn btn-secondary me-2">Test Room Connection</button>
                        <span id="test-firebase-status" class="text-success" style="display: none;">‚úÖ</span>
                    </div>
                    <h6>Debugging</h6>
                    <div class="mb-3">
                        <button id="reset-dice" class="btn btn-danger w-100">Reset Dice</button>
                        <div id="reset-dice-status" class="mt-2 small" style="display: none;"></div>
                    </div>
                    <div class="mb-3">
                        <button id="reset-locked-dice" class="btn btn-warning w-100">Reset Locked Dice</button>
                        <div id="reset-locked-dice-status" class="mt-2 small" style="display: none;"></div>
                    </div>
                    <div class="mb-3">
                        <button id="pass-turn-test" class="btn btn-info w-100">Pass Turn (Test)</button>
                        <div id="pass-turn-test-status" class="mt-2 small" style="display: none;"></div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Materials Modal -->
    <div class="modal fade" id="materialsModal" tabindex="-1" aria-labelledby="materialsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="materialsModalLabel">Customize Materials</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h6>Quick Presets</h6>
                    <div class="mb-3">
                        <div class="row g-2">
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 preset-option" data-preset="casino">
                                    üé∞ Casino
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 preset-option" data-preset="luxury">
                                    üíé Luxury
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 preset-option" data-preset="classic">
                                    üå∞ Classic
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 preset-option" data-preset="modern">
                                    üîß Modern
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 preset-option" data-preset="garden">
                                    üåø Garden
                                </button>
                            </div>
                            <div class="col-6">
                                <button class="btn btn-outline-primary w-100 preset-option" data-preset="elegant">
                                    ü•Ç Elegant
                                </button>
                            </div>
                        </div>
                        <small class="text-muted d-block mt-2">Click a preset to automatically select dice and floor materials</small>
                    </div>

                    <hr>

                    <h6>Dice Material</h6>
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="wood" data-type="dice">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #8B4513, #A0522D); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Wood
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="metal" data-type="dice">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #C0C0C0, #E5E5E5); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Metal
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="marble" data-type="dice">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #F8F8FF, #E6E6FA); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Marble
                                </button>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="plastic" data-type="dice">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #FF6347, #FF7F50); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Plastic
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="glass" data-type="dice">
                                    <div class="material-preview" style="background: linear-gradient(45deg, rgba(173,216,230,0.8), rgba(135,206,235,0.8)); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Glass
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option active" data-material="default" data-type="dice">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #FFFFFF, #F0F0F0); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Default
                                </button>
                            </div>
                        </div>
                    </div>

                    <h6>Floor Material</h6>
                    <div class="mb-3">
                        <div class="row">
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="wood" data-type="floor">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #8B4513, #A0522D); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Wood
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="stone" data-type="floor">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #696969, #808080); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Stone
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="carpet" data-type="floor">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #8B0000, #B22222); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Carpet
                                </button>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="marble" data-type="floor">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #F8F8FF, #E6E6FA); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Marble
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option" data-material="felt" data-type="floor">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #006400, #228B22); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Felt
                                </button>
                            </div>
                            <div class="col-4">
                                <button class="btn btn-outline-secondary w-100 material-option active" data-material="grass" data-type="floor">
                                    <div class="material-preview" style="background: linear-gradient(45deg, #228B22, #32CD32); height: 30px; border-radius: 4px; margin-bottom: 5px;"></div>
                                    Grass
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-outline-danger" id="clear-preferences">Clear Saved Preferences</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="apply-materials">Apply Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scoring Guide Modal -->
    <div class="modal fade" id="scoringModal" tabindex="-1" aria-labelledby="scoringModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="scoringModalLabel">üé≤ Farkle Scoring Guide</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="text-primary">üèÜ Special Combinations</h6>
                            <div class="table-responsive">
                                <table class="table table-sm table-striped">
                                    <tbody>
                                        <tr><td><strong>Six of any kind</strong></td><td class="text-success">3,000 pts</td></tr>
                                        <tr><td><strong>Straight (1-2-3-4-5-6)</strong></td><td class="text-success">1,500 pts</td></tr>
                                        <tr><td><strong>Three pairs</strong></td><td class="text-success">1,500 pts</td></tr>
                                        <tr><td><strong>Four of a kind + pair</strong></td><td class="text-success">1,500 pts</td></tr>
                                        <tr><td><strong>Two triplets</strong></td><td class="text-success">2,500 pts</td></tr>
                                        <tr><td><strong>Five of any kind</strong></td><td class="text-success">2,000 pts</td></tr>
                                        <tr><td><strong>Four of any kind</strong></td><td class="text-success">1,000 pts</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <h6 class="text-primary mt-4">üéØ Three of a Kind</h6>
                            <div class="table-responsive">
                                <table class="table table-sm table-striped">
                                    <tbody>
                                        <tr id="three-ones-row"><td><strong>Three 1s</strong></td><td class="text-success">1,000 pts</td></tr>
                                        <tr><td><strong>Three 2s</strong></td><td class="text-success">200 pts</td></tr>
                                        <tr><td><strong>Three 3s</strong></td><td class="text-success">300 pts</td></tr>
                                        <tr><td><strong>Three 4s</strong></td><td class="text-success">400 pts</td></tr>
                                        <tr><td><strong>Three 5s</strong></td><td class="text-success">500 pts</td></tr>
                                        <tr><td><strong>Three 6s</strong></td><td class="text-success">600 pts</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <h6 class="text-primary">üé≤ Individual Dice</h6>
                            <div class="table-responsive">
                                <table class="table table-sm table-striped">
                                    <tbody>
                                        <tr><td><strong>Each 1</strong></td><td class="text-success">100 pts</td></tr>
                                        <tr><td><strong>Each 5</strong></td><td class="text-success">50 pts</td></tr>
                                        <tr><td>Each 2, 3, 4, or 6</td><td class="text-muted">0 pts</td></tr>
                                    </tbody>
                                </table>
                            </div>
                            
                            <h6 class="text-primary mt-4">üí° Game Rules</h6>
                            <ul class="list-unstyled small">
                                <li><strong>üéØ Goal:</strong> First to 10,000 points wins</li>
                                <li><strong>üöÄ Entry:</strong> Need 500+ points to get "on the board"</li>
                                <li><strong>üí• Farkle:</strong> No scoring dice = lose all pending points</li>
                                <li><strong>üèÅ Hot Dice:</strong> Score with all 6 dice = roll again</li>
                                <li><strong>üîí Lock & Roll:</strong> Lock scoring dice, roll the rest</li>
                                <li><strong>üè¶ Banking:</strong> Bank points to secure them and end turn</li>
                            </ul>
                            
                            <div class="alert alert-info mt-3">
                                <small><strong>üí° Pro Tip:</strong> Higher combinations override individual dice scoring. For example, three 1s = 1,000 points (not 300 points for 3 individual 1s).</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Got it!</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Game Settings Modal (Host Only) -->
    <div class="modal fade" id="gameSettingsModal" tabindex="-1" aria-labelledby="gameSettingsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="gameSettingsModalLabel">üéØ Game Rule Settings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="alert alert-info">
                        <strong>üè† Host Only:</strong> These settings apply to all players in the room.
                    </div>
                    
                    <h6>Scoring Rules</h6>
                    <div class="mb-4">
                        <label class="form-label"><strong>Three 1s Scoring:</strong></label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="threeOnesRule" id="threeOnes300" value="300">
                            <label class="form-check-label" for="threeOnes300">
                                <strong>300 points</strong> - Classic/Conservative rule
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="threeOnesRule" id="threeOnes1000" value="1000" checked>
                            <label class="form-check-label" for="threeOnes1000">
                                <strong>1,000 points</strong> - Modern/Standard rule (recommended)
                            </label>
                        </div>
                        <small class="text-muted">This affects how much three 1s are worth. Other three-of-a-kind remain unchanged.</small>
                    </div>
                    
                    <h6>Game Settings</h6>
                    <div class="mb-3">
                        <label for="winningScore" class="form-label"><strong>Winning Score:</strong></label>
                        <select class="form-select" id="winningScore">
                            <option value="5000">5,000 points (Quick game)</option>
                            <option value="10000" selected>10,000 points (Standard)</option>
                            <option value="15000">15,000 points (Long game)</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="minimumScore" class="form-label"><strong>Minimum Score to Get on Board:</strong></label>
                        <select class="form-select" id="minimumScore">
                            <option value="300">300 points</option>
                            <option value="500" selected>500 points (Standard)</option>
                            <option value="750">750 points</option>
                            <option value="1000">1,000 points</option>
                        </select>
                    </div>
                    
                    <div class="alert alert-warning">
                        <small><strong>‚ö†Ô∏è Note:</strong> Changing rules will reset all current scores and restart the game.</small>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="apply-game-settings">Apply Settings</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="js/firebase-config.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cannon.js/0.6.2/cannon.min.js"></script>
    <script src="js/farkle-scoring.js"></script>
    <script src="js/game-settings.js"></script>
    <script src="js/material-config.js"></script>
    <script src="js/turn-system-integration.js"></script>
    <script src="js/firebase-state-manager.js"></script>
    <script src="js/game.js"></script>
    <script src="js/webrtc.js"></script>
</body>
</html>
